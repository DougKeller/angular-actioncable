var ngActionCable=angular.module("ngActionCable",["ngWebSocket"]);ngActionCable.factory("SocketWrangler",["Websocket",function(n){var e=8647,t=n,c=!1,o=!1,a=function(){t.attempt_restart()},s=function(){o=o||setInterval(function(){a()},e)},i=function(){clearInterval(o),o=!1};t.on_connection_close_callback=function(){c&&s(),console.log("close callback")},t.on_connection_open_callback=function(){i(),console.log("open callback")};var l={connected:function(){return c&&!o},connecting:function(){return c&&!!o},disconnected:function(){return!c},start:function(){console.info("Live STARTED"),c=!0,s(),a()},stop:function(){console.info("Live stopped"),c=!1,i(),t.close()}};return l}]),ngActionCable.factory("Websocket",["$websocket","WebsocketController","WebsocketConfig",function(n,e,t){var c,o=t.wsUri,a=e,s=null,i=!1,l=[],r=function(){s&&(s.close({force:!0}),s=null,i=!1)},u=function(n,e){"undefined"==typeof e&&(e="N/A"),console.log("-> subscribing to: "+n),h().send(JSON.stringify({command:"subscribe",identifier:JSON.stringify({channel:n,data:e})}))},f=function(n,e){"undefined"==typeof e&&(e="N/A"),console.log("<- unsubscribing from: "+n),h().send(JSON.stringify({command:"unsubscribe",identifier:JSON.stringify({channel:n,data:e})}))},b=function(n,e,t,c){"undefined"==typeof e&&(e="N/A"),console.log("=> sending to: "+n),h().send(JSON.stringify({command:"message",identifier:JSON.stringify({channel:n,data:e}),data:JSON.stringify({message:t,action:c})}))},h=function(){return null==s&&(s=n(o),s.onClose(function(n){r(),i=!1,c.on_connection_close_callback()}),s.onOpen(function(n){i=!0,l.forEach(function(n){u(n.name,n.data)}),c.on_connection_open_callback()}),s.onMessage(function(n){a.post(JSON.parse(n.data))})),s};return c={connected:function(){return i},attempt_restart:function(){return r(),h(),!0},currentChannels:l,close:function(){return r()},on_connection_close_callback:function(){},on_connection_open_callback:function(){},subscribe:function(n,e){l.push({name:n,data:e}),this.connected()&&u(n,e)},unsubscribe:function(n,e){for(var t=0;t<l.length;t++)l[t].name===n&&l.splice(t,1);this.connected()&&f(n,e)},send:function(n,e,t,c){console.log("send requested"),this.connected()&&b(n,e,t,c)}}}]),ngActionCable.factory("WebsocketChannel",["WebsocketController","Websocket",function(n,e){return function(t,c){this._websocketControllerActions=function(){var e=JSON.stringify(this.channelParams);return n.actions[this.channelName]=n.actions[this.channelName]||{},n.actions[this.channelName][e]=n.actions[this.channelName][e]||[],n.actions[this.channelName][e]},this._subscriptionCount=function(){return this.callbacks.length},this.channelName=t,this.channelParams=c||{},this.onMessageCallback=null,this.callbacks=this._websocketControllerActions(),this.subscribe=function(n){0===this._subscriptionCount()&&e.subscribe(this.channelName,this.channelParams),this._addMessageCallback(n)},this.unsubscribe=function(){this._removeMessageCallback(),0===this._subscriptionCount()&&e.unsubscribe(this.channelName,this.channelParams)},this.send=function(n,t){e.send(this.channelName,this.channelParams,n,t)},this._addMessageCallback=function(n){this.onMessageCallback=n,this.callbacks.push(this.onMessageCallback)},this._removeMessageCallback=function(){for(var n=0;n<this.callbacks.length;n++)if(this.callbacks[n]===this.onMessageCallback)return this.callbacks.splice(n,1),this.onMessageCallback=null,!0;throw console.log("Callbacks:"),console.log(this.callbacks),console.log("onMessageCallback:"),console.log(this.onMessageCallback),"can't find onMessageCallback in callbacks array to remove"}}}]),ngActionCable.value("WebsocketConfig",{autoStart:!0,wsUri:angular.element("meta[name='action-cable-url']").attr("content")||"",debug:!1}),ngActionCable.factory("WebsocketController",function(){function n(n,e){return c[n]&&c[n][e]}function e(n){return n&&n.identifier?JSON.parse(n.identifier).channel:void 0}function t(n){var e=JSON.parse(n.identifier).data;return JSON.stringify(e)}var c={welcome:function(n){},ping:function(n){},confirm_subscription:function(n){},ws_404:function(n){}},o=function(n,e){angular.forEach(n,function(n,t){n.apply(null,[e])})},a=function(a){if(c[a.type])c[a.type](a);else if(n(e(a),t(a))){var s=n(e(a),t(a));o(s,a.message)}else c.ws_404(a)},s={post:function(n){return a(n)},actions:c};return s});